# 🎮 謎解きWebアプリ 設計仕様書

## 🔧 技術スタック
- **フロントエンド**: React + TypeScript
- **状態管理**: useState / useReducer
- **スタイリング**: Tailwind CSS
- **アニメーション**: Framer Motion（必要に応じて）
- **描画**: Canvas or SVG（ステージ0・5で使用）

## 🗂 アプリケーション構成

### 画面遷移管理
- `currentStage: number` で現在のステージを管理
- 各ステージは `<Stage0>` ～ `<Stage5>` コンポーネントで実装
- クリア条件達成時に `setStage(n + 1)` で次ステージへ遷移

### ディレクトリ構造
```
src/
├── components/
│   ├── stages/
│   │   ├── Stage0.tsx  # ローディング画面
│   │   ├── Stage1.tsx  # ログイン画面
│   │   ├── Stage2.tsx  # メール画面
│   │   ├── Stage3.tsx  # ファイルブラウザ
│   │   ├── Stage4.tsx  # 設定画面
│   │   └── Stage5.tsx  # ターミナル画面
│   └── common/
│       └── StageManager.tsx
├── hooks/
├── types/
└── utils/
```

## 📋 各ステージ詳細仕様

### ✅ ステージ 0：ローディング画面
**謎の内容**: 
- 起動演出後、「START」ボタンが見えない／偽UIに埋もれている
- 謎を解くと次に進める

**実装指示**:
- Canvasでノイズアニメーション + フェイクUI描画
- 本物の「START」ボタンは透明 or DOM外に配置
- `onClick`で `goToStage(1)` を呼び出し

**技術要件**:
- Canvas API使用
- 偽装UI要素の配置
- 隠しボタンの実装

---

### ✅ ステージ 1：ログイン画面（透明UI）
**謎の内容**:
- ログインボタンは反応しない
- 入力欄は画面をドラッグすると出現

**実装指示**:
- 非表示の `<input>` 要素を `onDrag` or `onMouseMove` で表示
- 入力欄出現後、ログイン機能が有効化
- ドラッグ操作による要素の透明度変更

**技術要件**:
- マウスイベント処理
- 要素の動的表示制御
- CSS transform/opacity操作

---

### ✅ ステージ 2：メール画面（属性に謎）
**謎の内容**:
- メールUI風（件名・本文・添付ファイル）
- `alt`属性や`data-hint`にヒントが隠されている
- DOM検査しないと見えない情報

**実装指示**:
- JSXで添付画像に `alt="次のパスは /unlock"` など
- hover/clickでヒント表示のツールチップ
- 特定文字列発見で遷移ボタン出現

**技術要件**:
- DOM属性の活用
- ツールチップ実装
- 文字列検索機能

---

### ✅ ステージ 3：ファイルブラウザ風
**謎の内容**:
- フォルダ・ファイル一覧UI（ドラッグで並び替え可能）
- 正しい順に並べるとパスが成立し、開ける

**実装指示**:
- 配列のソート + 正解チェック機能
- 例：`["home", "user", "project"]` → `"/home/user/project"` が正解
- ドラッグ&ドロップによる並び替え

**技術要件**:
- ドラッグ&ドロップ API
- 配列操作・ソート
- パス文字列の検証

---

### ✅ ステージ 4：設定画面／GUI謎
**謎の内容**:
- スライダー、トグル、チェックボックスなどのGUI要素
- 正しい順番・組み合わせでロック解除

**実装指示**:
- 全要素の状態を `useState` で管理
- 正しい組み合わせ検知で次ステージへ遷移
- リアルタイム状態監視

**技術要件**:
- フォーム要素の状態管理
- 複数条件の論理演算
- UI要素のバリデーション

---

### ✅ ステージ 5：ターミナル風UI（rm -rf）
**謎の内容**:
- ターミナル風画面に `sudo rm -rf /` を入力すると脱出
- 入力後は画面が壊れていく演出

**実装指示**:
- 黒背景・緑文字のターミナルUI（Canvas or 文字描画）
- `<input>` でコマンド入力
- 正規表現で `sudo rm -rf /` 検出 → 演出開始
- `setInterval` で画面崩壊演出（ノイズ・ログ・爆破）

**技術要件**:
- ターミナル風UIデザイン
- 正規表現によるコマンド検証
- アニメーション・演出効果

## 🧪 テスト要件

### 機能テスト
- 各ステージの個別動作確認
- ステージ遷移の正常性
- 謎解きギミックの精度

### 技術テスト
- `?stage=2` などのクエリパラメータ対応（開発時）
- ターミナル入力の誤検出防止（trim, regex検査）
- レスポンシブ対応

### パフォーマンステスト
- Canvas描画のフレームレート
- アニメーション処理の最適化

## 🎨 UI/UX要件

### デザイン指針
- 各ステージごとに異なるUIテーマ
- 直感的でありながら謎解き要素を含む操作性
- 没入感のあるアニメーション演出

### アクセシビリティ
- キーボード操作対応（可能な範囲で）
- スクリーンリーダー対応は謎解きの性質上限定的

### ブラウザ対応
- モダンブラウザ（Chrome, Firefox, Safari, Edge）
- Canvas APIサポート必須

## 📝 実装ノート

### 状態管理パターン
```typescript
interface GameState {
  currentStage: number;
  stageProgress: Record<number, any>;
  globalFlags: Record<string, boolean>;
}
```

### ステージコンポーネントインターface
```typescript
interface StageProps {
  onStageComplete: () => void;
  stageData?: any;
}
```

### セキュリティ考慮事項
- 謎解きの答えはフロントエンドに含まれる（クライアントサイドアプリのため）
- 難読化・最小化による軽微な保護
- 重要な情報は含まない設計

---

**最終更新**: 2024年12月
**バージョン**: 1.0.0 
